packages:  
  yum:
    make: []
    gcc-c++: []
    gcc-gfortran: []
    python34-devel: []
    atlas-sse3-devel: []
    lapack-devel: []
    libcurl-devel: []
sources:
  /home/ec2-user: http://download.redis.io/releases/redis-3.2.8.tar.gz
commands:
  00_pip_upgrade:
    command: /opt/python/run/venv/bin/pip install --upgrade pip
    ignoreErrors: false
  redis_build:
    command: make
    cwd: /home/ec2-user/redis-3.2.8
  redis_config_001:
    command: sed -i -e "s/daemonize no/daemonize yes/" redis.conf
    cwd: /home/ec2-user/redis-3.2.8
  redis_config_002:
    command: sed -i -e "s/# maxmemory <bytes>/maxmemory 500MB/" redis.conf
    cwd: /home/ec2-user/redis-3.2.8
  redis_config_003:
    command: sed -i -e "s/# maxmemory-policy volatile-lru/maxmemory-policy allkeys-lru/" redis.conf
    cwd: /home/ec2-user/redis-3.2.8
  redis_server:
    command: src/redis-server redis.conf
    cwd: /home/ec2-user/redis-3.2.8
container_commands:
  01_install_dependencies:
    command: /opt/python/run/venv/bin/pip install -r dependencies.txt
    ignoreErrors: false
  03_start_celery:
    command: /opt/python/run/venv/bin/circusd --daemon circus.ini
    ignoreErrors: false
  04_check_circus:
    command: /opt/python/run/venv/bin/circusctl stats
    ignoreErrors: false
option_settings:
  "aws:elasticbeanstalk:container:python":
    WSGIPath: run.py